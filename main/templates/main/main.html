{# main/templates/main/main.html #}
{% extends 'base.html' %}
{% load static %}
{% load currency %}

{% block meta %}
<title>Sports Universe</title>
{% endblock meta %}


{% block content %}
{% include 'navbar.html' %}

<div class="min-h-screen bg-gradient-to-b from-[#0f0220] via-[#110025] to-[#16002b] text-slate-100">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    
    {% csrf_token %}

    <h1 class="text-3xl font-extrabold tracking-tight text-white">
      Sports <span class="gradient-text">Universe</span></h1>
    <p class="text-sm text-violet-200 mt-2">
      Explore curated gear across the galaxy ðŸš€
    </p>

    <div class="mt-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4
                bg-black/40 border border-fuchsia-900/40 rounded-xl px-4 py-3">
      <div class="flex items-center gap-3">
        <a href="?"
            class="px-4 py-2 rounded-md font-semibold transition
                {% if active_filter == 'all' or not active_filter %}
                  bg-fuchsia-600 text-white
                {% else %}
                  bg-slate-800 text-slate-200 hover:bg-slate-700
                {% endif %}">
          All Products
        </a>

        {% if user.is_authenticated %}
        <a href="?filter=my{% if active_category %}&category={{ active_category }}{% endif %}"
            class="px-4 py-2 rounded-md font-semibold transition
                {% if active_filter == 'my' %}
                  bg-fuchsia-600 text-white
                {% else %}
                  bg-slate-800 text-slate-200 hover:bg-slate-700
                {% endif %}">
          My Products
        </a>
        {% endif %}
      </div>

      <div class="text-xs md:text-sm text-violet-300">
        Last login: {{ last_login }}
      </div>
    </div>

    <div class="mt-4 flex flex-wrap items-center gap-2">
      {# "All" chip #}
      <a href="?{% if active_filter == 'my' %}filter=my{% endif %}"
          class="px-3 py-1.5 rounded-full text-sm font-medium border transition
              {% if not active_category %}
                bg-fuchsia-700 text-white border-fuchsia-600
              {% else %}
                bg-slate-800/70 text-violet-100 border-slate-700 hover:bg-slate-700
              {% endif %}">
        All
      </a>

      {% for value, label in CATEGORY_CHOICES %}
        <a href="?category={{ value }}{% if active_filter == 'my' %}&filter=my{% endif %}"
            class="px-3 py-1.5 rounded-full text-sm font-medium border transition capitalize
                {% if active_category == value %}
                  bg-fuchsia-700 text-white border-fuchsia-600
                {% else %}
                  bg-slate-800/70 text-violet-100 border-slate-700 hover:bg-slate-700
                {% endif %}">
          {{ label }}
        </a>
      {% endfor %}
    </div>

    {# ------- Controls: Refresh + States ------- #}
    <div class="mt-6 mb-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button id="refresh-products-btn" class="px-3 py-2 rounded bg-fuchsia-700 text-white hover:opacity-90">
          Refresh
        </button>

        {# Loading spinner (has opacity/transition classes for fade) #}
        <div id="product-loading" class="hidden opacity-0 flex flex-col items-center justify-center py-16 text-slate-300 transition-opacity duration-300">
          <div class="w-10 h-10 border-4 border-fuchsia-500 border-t-transparent rounded-full animate-spin mb-4"></div>
          <p class="text-sm tracking-wide">Loading products...</p>
        </div>

        {# Empty and Error placeholders (empty uses the styled original block) #}
        <div id="product-error" class="hidden text-sm text-rose-400">Failed to load products.</div>
      </div>

      <div class="text-xs md:text-sm text-violet-300">
        <!-- optional: show number of products or other info -->
      </div>
    </div>

    {# ------- Product list container (server renders initial fragment) ------- #}
    <div id="product-list-container">
      {% include 'main/_product_list_fragment.html' %}
    </div>

    {# ------- Styled Empty block (kept outside the product list so JS can toggle it) ------- #}
    <div id="product-empty" class="hidden mt-8 rounded-2xl border border-fuchsia-900/40 bg-black/40 p-10 text-center">
      <img src="{% static 'image/no-product.png' %}" alt="No products"
            class="mx-auto w-40 h-40 object-contain opacity-90 mb-4">
      <h3 class="text-xl font-semibold text-violet-100">No products yet</h3>
      <p class="text-slate-300 mt-1">Be the first to add an item to the universe.</p>

      <a href="{% url 'main:add_object' %}"
          class="inline-block mt-6 px-5 py-3 rounded-lg bg-fuchsia-600 text-white font-semibold hover:bg-fuchsia-500 transition">
        + Add Product
      </a>
    </div>

  </div>
</div>
{% endblock content %}

